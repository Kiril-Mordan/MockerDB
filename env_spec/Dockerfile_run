# Collect latest image from docker registry
FROM kyriosskia/mocker-db-dependancies:latest

# Upgrade to the latest version of mockerdb
RUN pip install --upgrade pip
RUN pip install mocker-db

# Install Sentence Transformers
RUN pip install --no-cache-dir sentence-transformers

# Copy the models.txt file into the container
COPY env_spec/embedding_models.txt /app/models.txt

# Download the Sentence Transformer models listed in models.txt
RUN python -c "from sentence_transformers import SentenceTransformer; [SentenceTransformer(model.strip()) for model in open('/app/models.txt').readlines()]"

# Copy and select as working directory files from pulled docker image
COPY . /app
WORKDIR /app

# Making port 80 available outside of the container
EXPOSE 8080

# Command to run the Uvicorn server
CMD ["uvicorn", "main:app" , "--host", "0.0.0.0", "--port", "8080"]